fixtures:
  - APIFixture

defaults:
  request_headers:
    x-auth-token: admin
    accept: application/json
    openstack-api-version: placement latest

tests:

# --- List Empty ---

- name: list empty resource classes
  GET: /resource_classes
  status: 200
  response_json_paths:
    $.resource_classes: []

# --- Create Custom Resource Class ---

- name: create custom resource class
  PUT: /resource_classes/CUSTOM_DISK
  status: 201

- name: create another custom resource class
  PUT: /resource_classes/CUSTOM_ACCELERATOR
  status: 201

# --- Get ---

- name: get resource class
  GET: /resource_classes/CUSTOM_DISK
  status: 200
  response_json_paths:
    $.name: CUSTOM_DISK

- name: get nonexistent resource class
  GET: /resource_classes/NONEXISTENT
  status: 404
  response_json_paths:
    $.errors[0].status: 404

# --- List ---

- name: list resource classes
  GET: /resource_classes
  status: 200
  response_json_paths:
    $.resource_classes.`len`: 2

# --- Standard Resource Classes ---
# Standard resource classes like VCPU cannot be created via PUT
# They may be auto-created when used in inventory, or not exposed

- name: creating standard resource class via PUT fails
  PUT: /resource_classes/VCPU
  status: 400
  response_strings:
    - "'name' value must start with 'CUSTOM_'"

# --- Delete ---

- name: delete custom resource class
  DELETE: /resource_classes/CUSTOM_ACCELERATOR
  status: 204

- name: verify deleted
  GET: /resource_classes/CUSTOM_ACCELERATOR
  status: 404

- name: delete nonexistent resource class
  DELETE: /resource_classes/NONEXISTENT
  status: 404

# --- Bodiless PUT tests at 1.7+ ---

- name: create new custom class with put returns 201
  PUT: /resource_classes/CUSTOM_COW
  request_headers:
    openstack-api-version: placement 1.7
  status: 201
  response_headers:
    location: //resource_classes/CUSTOM_COW/

- name: put existing custom class returns 204
  PUT: /resource_classes/CUSTOM_COW
  request_headers:
    openstack-api-version: placement 1.7
  status: 204
  response_headers:
    location: //resource_classes/CUSTOM_COW/

- name: fail to put non custom class
  PUT: /resource_classes/COW
  request_headers:
    openstack-api-version: placement 1.7
  status: 400
  response_strings:
    - "'name' value must start with 'CUSTOM_'"

- name: fail to put standard class via PUT
  PUT: /resource_classes/MEMORY_MB
  request_headers:
    openstack-api-version: placement 1.7
  status: 400
  response_strings:
    - "'name' value must start with 'CUSTOM_'"
